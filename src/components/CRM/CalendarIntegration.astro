---
// Calendar Integration with Outlook Calendar and Teams Meetings
---

<div class="h-full flex flex-col bg-white dark:bg-gray-800">
  <!-- Calendar Header -->
  <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
    <div class="flex items-center gap-4">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Calendar</h2>
      <div class="flex items-center gap-2">
        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
        <span class="text-sm text-green-600 dark:text-green-400">Outlook Calendar Connected</span>
      </div>
    </div>
    
    <div class="flex items-center gap-3">
      <!-- View Toggle -->
      <div class="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
        <button class="calendar-view-btn active" data-view="month">Month</button>
        <button class="calendar-view-btn" data-view="week">Week</button>
        <button class="calendar-view-btn" data-view="day">Day</button>
        <button class="calendar-view-btn" data-view="agenda">Agenda</button>
      </div>
      
      <button class="btn-secondary" id="syncCalendarBtn">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Sync
      </button>
      
      <div class="relative">
        <button class="btn-primary" id="createEventBtn">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          New Event
        </button>
        
        <!-- Quick Event Options -->
        <div class="absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 hidden" id="quickEventMenu">
          <div class="p-2">
            <button class="quick-event-btn" data-type="meeting">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
              </svg>
              Teams Meeting
            </button>
            <button class="quick-event-btn" data-type="call">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              Phone Call
            </button>
            <button class="quick-event-btn" data-type="followup">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Follow-up
            </button>
            <button class="quick-event-btn" data-type="reminder">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Reminder
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="flex flex-1 overflow-hidden">
    <!-- Calendar Sidebar -->
    <div class="w-64 border-r border-gray-200 dark:border-gray-700 overflow-y-auto">
      <!-- Mini Calendar -->
      <div class="p-4">
        <div class="text-center mb-4">
          <div class="flex items-center justify-between mb-2">
            <button id="prevMonth" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
            <h3 class="text-sm font-semibold text-gray-900 dark:text-white" id="currentMonth">December 2024</h3>
            <button id="nextMonth" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
          
          <!-- Mini Calendar Grid -->
          <div class="grid grid-cols-7 gap-1 text-xs">
            <div class="text-gray-500 dark:text-gray-400 font-medium">S</div>
            <div class="text-gray-500 dark:text-gray-400 font-medium">M</div>
            <div class="text-gray-500 dark:text-gray-400 font-medium">T</div>
            <div class="text-gray-500 dark:text-gray-400 font-medium">W</div>
            <div class="text-gray-500 dark:text-gray-400 font-medium">T</div>
            <div class="text-gray-500 dark:text-gray-400 font-medium">F</div>
            <div class="text-gray-500 dark:text-gray-400 font-medium">S</div>
            
            <!-- Calendar Days -->
            <div class="text-gray-400 dark:text-gray-600 p-1">1</div>
            <div class="text-gray-400 dark:text-gray-600 p-1">2</div>
            <div class="text-gray-400 dark:text-gray-600 p-1">3</div>
            <div class="text-gray-400 dark:text-gray-600 p-1">4</div>
            <div class="text-gray-400 dark:text-gray-600 p-1">5</div>
            <div class="text-gray-400 dark:text-gray-600 p-1">6</div>
            <div class="text-gray-400 dark:text-gray-600 p-1">7</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">8</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">9</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">10</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">11</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">12</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">13</div>
            <div class="bg-blue-500 text-white p-1 rounded cursor-pointer">14</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">15</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">16</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">17</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">18</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">19</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">20</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">21</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">22</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">23</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">24</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">25</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">26</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">27</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">28</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">29</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">30</div>
            <div class="text-gray-900 dark:text-white p-1 hover:bg-blue-100 dark:hover:bg-blue-900 rounded cursor-pointer">31</div>
          </div>
        </div>
      </div>
      
      <!-- My Calendars -->
      <div class="p-4 border-t border-gray-200 dark:border-gray-700">
        <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">My Calendars</h3>
        <div class="space-y-2">
          <label class="flex items-center">
            <input type="checkbox" checked class="rounded border-gray-300 dark:border-gray-600 text-blue-600 dark:bg-gray-700" />
            <div class="w-3 h-3 bg-blue-500 rounded-full ml-2 mr-2"></div>
            <span class="text-sm text-gray-700 dark:text-gray-300">Work Calendar</span>
          </label>
          
          <label class="flex items-center">
            <input type="checkbox" checked class="rounded border-gray-300 dark:border-gray-600 text-green-600 dark:bg-gray-700" />
            <div class="w-3 h-3 bg-green-500 rounded-full ml-2 mr-2"></div>
            <span class="text-sm text-gray-700 dark:text-gray-300">Client Meetings</span>
          </label>
          
          <label class="flex items-center">
            <input type="checkbox" class="rounded border-gray-300 dark:border-gray-600 text-purple-600 dark:bg-gray-700" />
            <div class="w-3 h-3 bg-purple-500 rounded-full ml-2 mr-2"></div>
            <span class="text-sm text-gray-700 dark:text-gray-300">Personal</span>
          </label>
          
          <label class="flex items-center">
            <input type="checkbox" checked class="rounded border-gray-300 dark:border-gray-600 text-orange-600 dark:bg-gray-700" />
            <div class="w-3 h-3 bg-orange-500 rounded-full ml-2 mr-2"></div>
            <span class="text-sm text-gray-700 dark:text-gray-300">Follow-ups</span>
          </label>
        </div>
      </div>
      
      <!-- Upcoming Events -->
      <div class="p-4 border-t border-gray-200 dark:border-gray-700">
        <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Upcoming</h3>
        <div class="space-y-3">
          <div class="flex items-start gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg cursor-pointer">
            <div class="w-3 h-3 bg-blue-500 rounded-full mt-1.5"></div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-900 dark:text-white truncate">Client Kickoff - Acme Corp</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Tomorrow, 2:00 PM</p>
              <div class="flex items-center gap-1 mt-1">
                <svg class="w-3 h-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <span class="text-xs text-gray-500 dark:text-gray-400">Teams Meeting</span>
              </div>
            </div>
          </div>
          
          <div class="flex items-start gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg cursor-pointer">
            <div class="w-3 h-3 bg-green-500 rounded-full mt-1.5"></div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-900 dark:text-white truncate">Follow-up: Sarah Johnson</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Monday, 10:00 AM</p>
              <div class="flex items-center gap-1 mt-1">
                <svg class="w-3 h-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
                <span class="text-xs text-gray-500 dark:text-gray-400">Phone Call</span>
              </div>
            </div>
          </div>
          
          <div class="flex items-start gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg cursor-pointer">
            <div class="w-3 h-3 bg-orange-500 rounded-full mt-1.5"></div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-900 dark:text-white truncate">Proposal Review</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Tuesday, 3:30 PM</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Calendar View -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Calendar Navigation -->
      <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2">
            <button id="prevPeriod" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white" id="calendarTitle">December 2024</h2>
            <button id="nextPeriod" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
          
          <button class="btn-secondary" id="todayBtn">Today</button>
        </div>
        
        <div class="flex items-center gap-2">
          <div class="text-sm text-gray-600 dark:text-gray-400">
            <span class="font-medium">14</span> events this month
          </div>
        </div>
      </div>
      
      <!-- Calendar Grid -->
      <div class="flex-1 overflow-auto">
        <div id="calendar-month-view" class="calendar-view">
          <!-- Month View Header -->
          <div class="grid grid-cols-7 border-b border-gray-200 dark:border-gray-700">
            <div class="p-3 text-sm font-medium text-gray-500 dark:text-gray-400 text-center">Sunday</div>
            <div class="p-3 text-sm font-medium text-gray-500 dark:text-gray-400 text-center">Monday</div>
            <div class="p-3 text-sm font-medium text-gray-500 dark:text-gray-400 text-center">Tuesday</div>
            <div class="p-3 text-sm font-medium text-gray-500 dark:text-gray-400 text-center">Wednesday</div>
            <div class="p-3 text-sm font-medium text-gray-500 dark:text-gray-400 text-center">Thursday</div>
            <div class="p-3 text-sm font-medium text-gray-500 dark:text-gray-400 text-center">Friday</div>
            <div class="p-3 text-sm font-medium text-gray-500 dark:text-gray-400 text-center">Saturday</div>
          </div>
          
          <!-- Calendar Days -->
          <div class="grid grid-cols-7 auto-rows-fr" style="min-height: 600px;">
            <!-- Week 1 -->
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-01">
              <div class="text-gray-400 dark:text-gray-600 text-sm">1</div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-02">
              <div class="text-gray-400 dark:text-gray-600 text-sm">2</div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-03">
              <div class="text-gray-400 dark:text-gray-600 text-sm">3</div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-04">
              <div class="text-gray-400 dark:text-gray-600 text-sm">4</div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-05">
              <div class="text-gray-400 dark:text-gray-600 text-sm">5</div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-06">
              <div class="text-gray-400 dark:text-gray-600 text-sm">6</div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-07">
              <div class="text-gray-400 dark:text-gray-600 text-sm">7</div>
            </div>
            
            <!-- Week 2 -->
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-08">
              <div class="text-gray-900 dark:text-white text-sm font-medium">8</div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-09">
              <div class="text-gray-900 dark:text-white text-sm font-medium">9</div>
              <div class="calendar-event bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs p-1 rounded mt-1 cursor-pointer" data-event-id="1">
                <div class="font-medium truncate">Team Standup</div>
                <div class="text-xs opacity-75">9:00 AM</div>
              </div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-10">
              <div class="text-gray-900 dark:text-white text-sm font-medium">10</div>
              <div class="calendar-event bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs p-1 rounded mt-1 cursor-pointer" data-event-id="2">
                <div class="font-medium truncate">Client Call - Tech Start</div>
                <div class="text-xs opacity-75">2:00 PM</div>
              </div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-11">
              <div class="text-gray-900 dark:text-white text-sm font-medium">11</div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-12">
              <div class="text-gray-900 dark:text-white text-sm font-medium">12</div>
              <div class="calendar-event bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs p-1 rounded mt-1 cursor-pointer" data-event-id="3">
                <div class="font-medium truncate">Proposal Review</div>
                <div class="text-xs opacity-75">1:30 PM</div>
              </div>
            </div>
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-13">
              <div class="text-gray-900 dark:text-white text-sm font-medium">13</div>
            </div>
            <div class="calendar-day today border border-blue-500 dark:border-blue-400 p-2 min-h-24 bg-blue-50 dark:bg-blue-900/20" data-date="2024-12-14">
              <div class="text-blue-600 dark:text-blue-400 text-sm font-bold">14</div>
              <div class="calendar-event bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs p-1 rounded mt-1 cursor-pointer" data-event-id="4">
                <div class="font-medium truncate">Project Kickoff</div>
                <div class="text-xs opacity-75">10:00 AM</div>
              </div>
              <div class="calendar-event bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 text-xs p-1 rounded mt-1 cursor-pointer" data-event-id="5">
                <div class="font-medium truncate">Follow-up Call</div>
                <div class="text-xs opacity-75">3:00 PM</div>
              </div>
            </div>
            
            <!-- Additional weeks would continue here... -->
            <!-- Week 3 -->
            <div class="calendar-day border border-gray-200 dark:border-gray-700 p-2 min-h-24" data-date="2024-12-15">
              <div class="text-gray-900 dark:text-white text-sm font-medium">15</div>
              <div class="calendar-event bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs p-1 rounded mt-1 cursor-pointer" data-event-id="6">
                <div class="font-medium truncate">Acme Corp - Kickoff</div>
                <div class="text-xs opacity-75">2:00 PM</div>
              </div>
            </div>
            <!-- Continue with remaining days... -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .calendar-view-btn {
    @apply px-3 py-1 text-sm font-medium text-gray-600 dark:text-gray-400 rounded-md transition-colors;
  }
  
  .calendar-view-btn.active {
    @apply bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm;
  }
  
  .calendar-view-btn:not(.active):hover {
    @apply text-gray-900 dark:text-white;
  }
  
  .quick-event-btn {
    @apply w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors;
  }
  
  .calendar-day {
    @apply relative cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors;
  }
  
  .calendar-day.today {
    @apply ring-2 ring-blue-500 dark:ring-blue-400;
  }
  
  .calendar-event {
    @apply mb-1 hover:opacity-80 transition-opacity;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    let currentView = 'month';
    let currentDate = new Date();
    
    // View toggle
    const viewButtons = document.querySelectorAll('.calendar-view-btn');
    
    viewButtons.forEach(button => {
      button.addEventListener('click', () => {
        viewButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        currentView = button.getAttribute('data-view') || 'month';
        updateCalendarView();
      });
    });
    
    // Quick event creation
    const createEventBtn = document.getElementById('createEventBtn');
    const quickEventMenu = document.getElementById('quickEventMenu');
    
    createEventBtn?.addEventListener('click', () => {
      quickEventMenu?.classList.toggle('hidden');
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!createEventBtn?.contains(e.target as Node) && !quickEventMenu?.contains(e.target as Node)) {
        quickEventMenu?.classList.add('hidden');
      }
    });
    
    // Quick event options
    const quickEventButtons = document.querySelectorAll('.quick-event-btn');
    
    quickEventButtons.forEach(button => {
      button.addEventListener('click', () => {
        const eventType = button.getAttribute('data-type');
        quickEventMenu?.classList.add('hidden');
        createQuickEvent(eventType);
      });
    });
    
    // Calendar navigation
    document.getElementById('prevPeriod')?.addEventListener('click', () => {
      navigateCalendar(-1);
    });
    
    document.getElementById('nextPeriod')?.addEventListener('click', () => {
      navigateCalendar(1);
    });
    
    document.getElementById('todayBtn')?.addEventListener('click', () => {
      currentDate = new Date();
      updateCalendarView();
    });
    
    // Calendar day clicks
    const calendarDays = document.querySelectorAll('.calendar-day');
    
    calendarDays.forEach(day => {
      day.addEventListener('click', (e) => {
        if (!e.target?.closest('.calendar-event')) {
          const date = day.getAttribute('data-date');
          createEventForDate(date);
        }
      });
    });
    
    // Event clicks
    const calendarEvents = document.querySelectorAll('.calendar-event');
    
    calendarEvents.forEach(event => {
      event.addEventListener('click', (e) => {
        e.stopPropagation();
        const eventId = event.getAttribute('data-event-id');
        openEventDetails(eventId);
      });
    });
    
    // Sync calendar
    document.getElementById('syncCalendarBtn')?.addEventListener('click', () => {
      syncOutlookCalendar();
    });
    
    // Functions
    function updateCalendarView() {
      const title = document.getElementById('calendarTitle');
      if (title) {
        switch (currentView) {
          case 'month':
            title.textContent = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            break;
          case 'week':
            title.textContent = `Week of ${currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
            break;
          case 'day':
            title.textContent = currentDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            break;
          case 'agenda':
            title.textContent = 'Agenda View';
            break;
        }
      }
      
      // Update mini calendar
      const miniCalTitle = document.getElementById('currentMonth');
      if (miniCalTitle) {
        miniCalTitle.textContent = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
      }
    }
    
    function navigateCalendar(direction: number) {
      switch (currentView) {
        case 'month':
          currentDate.setMonth(currentDate.getMonth() + direction);
          break;
        case 'week':
          currentDate.setDate(currentDate.getDate() + (direction * 7));
          break;
        case 'day':
          currentDate.setDate(currentDate.getDate() + direction);
          break;
      }
      updateCalendarView();
    }
    
    function createQuickEvent(eventType: string | null) {
      const eventTemplates = {
        meeting: {
          title: 'Teams Meeting',
          duration: 60,
          type: 'teams-meeting',
          description: 'Microsoft Teams meeting'
        },
        call: {
          title: 'Phone Call',
          duration: 30,
          type: 'phone-call',
          description: 'Phone call with client'
        },
        followup: {
          title: 'Follow-up',
          duration: 15,
          type: 'followup',
          description: 'Follow-up task'
        },
        reminder: {
          title: 'Reminder',
          duration: 0,
          type: 'reminder',
          description: 'Reminder task'
        }
      };
      
      const template = eventTemplates[eventType as keyof typeof eventTemplates];
      if (template) {
        openEventModal('new', template);
      }
    }
    
    function createEventForDate(date: string | null) {
      if (date) {
        openEventModal('new', { date });
      }
    }
    
    function openEventDetails(eventId: string | null) {
      if (eventId) {
        openEventModal('edit', { eventId });
      }
    }
    
    function openEventModal(mode: string, data: any = {}) {
      const isEdit = mode === 'edit';
      const isTeamsMeeting = data.type === 'teams-meeting';
      
      const modalContent = `
        <div class="p-6">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
              ${isEdit ? 'Edit Event' : 'Create New Event'}
            </h3>
            <button onclick="window.closeModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Title</label>
              <input type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" value="${data.title || ''}" placeholder="Event title" />
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date</label>
                <input type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" value="${data.date || new Date().toISOString().split('T')[0]}" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Duration</label>
                <select class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                  <option value="15">15 minutes</option>
                  <option value="30" ${data.duration === 30 ? 'selected' : ''}>30 minutes</option>
                  <option value="60" ${data.duration === 60 ? 'selected' : ''}>1 hour</option>
                  <option value="90">1.5 hours</option>
                  <option value="120">2 hours</option>
                </select>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Start Time</label>
                <input type="time" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" value="10:00" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">End Time</label>
                <input type="time" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" value="11:00" />
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Calendar</label>
              <select class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                <option value="work">Work Calendar</option>
                <option value="client" ${data.type === 'teams-meeting' ? 'selected' : ''}>Client Meetings</option>
                <option value="personal">Personal</option>
                <option value="followup">Follow-ups</option>
              </select>
            </div>
            
            ${isTeamsMeeting ? `
            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <div class="flex items-center gap-2 mb-2">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <span class="text-sm font-medium text-blue-900 dark:text-blue-100">Microsoft Teams Meeting</span>
              </div>
              <p class="text-sm text-blue-700 dark:text-blue-300">A Teams meeting link will be automatically generated and included in the invitation.</p>
              <div class="mt-2">
                <label class="flex items-center">
                  <input type="checkbox" class="rounded border-gray-300 dark:border-gray-600 text-blue-600" checked />
                  <span class="ml-2 text-sm text-blue-700 dark:text-blue-300">Allow attendees to join before host</span>
                </label>
              </div>
            </div>
            ` : ''}
            
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Attendees</label>
              <input type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Enter email addresses separated by commas" />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label>
              <textarea rows="4" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Event description...">${data.description || ''}</textarea>
            </div>
            
            <div class="flex items-center gap-4">
              <label class="flex items-center">
                <input type="checkbox" class="rounded border-gray-300 dark:border-gray-600 text-blue-600" />
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">All day event</span>
              </label>
              
              <label class="flex items-center">
                <input type="checkbox" class="rounded border-gray-300 dark:border-gray-600 text-blue-600" />
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Recurring event</span>
              </label>
              
              <label class="flex items-center">
                <input type="checkbox" class="rounded border-gray-300 dark:border-gray-600 text-red-600" />
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">High priority</span>
              </label>
            </div>
          </div>
          
          <div class="flex justify-between mt-6">
            <div>
              ${isEdit ? `
              <button class="btn-danger">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
                Delete Event
              </button>
              ` : ''}
            </div>
            <div class="flex gap-2">
              <button onclick="window.closeModal()" class="btn-secondary">Cancel</button>
              <button class="btn-primary">
                ${isEdit ? 'Update Event' : 'Create Event'}
              </button>
            </div>
          </div>
        </div>
      `;
      
      if (window.openModal) {
        window.openModal(modalContent);
      }
    }
    
    async function syncOutlookCalendar() {
      try {
        const syncBtn = document.getElementById('syncCalendarBtn');
        if (syncBtn) {
          syncBtn.innerHTML = '<svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>Syncing...';
        }
        
        const response = await fetch('/api/calendar/sync-outlook', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        });
        
        if (!response.ok) {
          throw new Error('Failed to sync calendar');
        }
        
        const result = await response.json();
        console.log('Calendar sync result:', result);
        
        if (syncBtn) {
          syncBtn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>Sync';
        }
        
        // Refresh calendar view
        location.reload();
        
      } catch (error) {
        console.error('Error syncing calendar:', error);
        alert('Failed to sync calendar. Please try again.');
      }
    }
    
    // Initialize the view
    updateCalendarView();
  });
</script>
